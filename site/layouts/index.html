{{ define "main" }}
<main class="md:mt-12 grid dd-grid-cols grid-flow-row">
  <div class="homepage-header grid-col-wide mb-8">
    {{.Content}}
  </div>

  <h2 class="px-6 grid-col-wide sm:grid-col-content font-bold text-accent text-2xl dd-col-wide">Latest writing</h2>

  <div class="grid-col-wide px-6 sm:px-0 sm:grid-col-content divide-y-2 divide-solid divide-gray-300">
    {{- range first 5 (where site.RegularPages "Type" "blog") -}}
    {{- $images := .Page.Resources.ByType "image" -}}
    {{- $featuredImg := $images.GetMatch "{*cover*,*feature*}" -}}
    {{- $featuredImgUrl := (index .Params "featured_image") -}}
    <article class="flex items-center py-3">
      <div class="flex-1">
        <a href="{{ .URL }}" class="block">
          <h2 class="deorphan text-ink-bold font-semibold text-lg sm:text-xl leading-tight sm:leading-tight">{{ .Title }}</h2>
          {{ with .Description }}<div class="text-sm mt-2">{{ . }}</div>{{ end }}
          <div class="text-ink-medium text-sm mt-2">{{ .Date.Format "Jan 2, 2006" }}</div>
        </a>
      </div> 
      {{- if (or $featuredImg $featuredImgUrl) -}}
      <a href="{{ .URL }}" class="w-24 h-24 ml-6 overflow-hidden rounded-md lg:col-span-2">
        {{ if $featuredImg }}
        {{ $thumb := $featuredImg.Fill "320x320" }}
        {{ $thumbURL := $thumb.RelPermalink }}
        <img loading="lazy" src="{{ $thumbURL }}" width="160" height="160" alt="Featured image for post" class="object-cover object-center h-full w-full" />
        {{ else if $featuredImgUrl }}
        {{ $featuredImgUrl := (partial "remote-img.html" (dict "URL" $featuredImgUrl "maxWidth" 320)) }}
        <img loading="lazy" src="{{ $featuredImgUrl }}" width="160" height="160" alt="Featured image for post" class="object-cover object-center h-full w-full" />
        {{ end }}
      </a>
      {{- end -}}
    </article>
    {{ end }}
  </div>

</main>
{{ end }}